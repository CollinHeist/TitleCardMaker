<!DOCTYPE html>
<html lang="en">

<head>
  <title>Connections - TitleCardMaker</title>
  {% include "./html_boilerplate.html" %}

  <script type="text/javascript">
    {% include "./js/connections.js" %}
  </script>

  <link rel="stylesheet" type="text/css" href="/templates/css/connections.css"/>

  <template id="interface-dropdown-template">
    <div data-value="interface_id" class="ui selection dropdown">
      <input type="hidden" name="interface_id">
      <i class="dropdown icon"></i>
      <div class="default text"></div>
      <div class="menu"></div>
    </div>
  </template>

  <template id="emby-connection-template">
    <div class="title">
      <i class="dropdown icon"></i>
      New Connection
    </div>
    <div class="content">
      <form class="ui fluid form" form-type="emby">
        <div data-value="enabled" class="ui left aligned checkbox field">
          <input name="enabled" type="checkbox">
          <label>Enabled</label>
        </div>

        <div class="ui required eight wide field">
          <label>Connection Name</label>
          <input name="name" type="text" placeholder="My Server">
        </div>

        <div class="ui required eight wide field" data-tooltip="Host URL">
          <label>URL</label>
          <input name="url" type="text" placeholder="http://192.168.0.1:8000/">
        </div>

        <div class="ui required eight wide field" data-tooltip="API key to authenticate communication with">
          <label>API Key</label>
          <input name="api_key" type="text" class="private" placeholder="abcdef">
        </div>

        <div class="ui required field" data-tooltip="Username of the user to query watch statuses from">
          <label>Username</label>
          <div data-value="username" class="ui compact selection dropdown">
            <input type="hidden" name="username">
            <i class="dropdown icon"></i>
            <div class="default text"></div>
            <div class="menu"></div>
          </div>
        </div>

        <div data-value="use_ssl" class="ui left aligned checkbox field" data-tooltip="Connect with HTTPS instead of HTTP">
          <input name="use_ssl" type="checkbox">
          <label>Use SSL</label>
        </div>

        <div class="ui eight wide field">
          <label>Filesize Limit</label>
          <input name="filesize_limit" type="text" placeholder="5 Megabytes">
        </div>

        <div class="ui error message"></div>
        <button class="ui primary animated button" type="submit" data-action="save">
          <div class="visible content">Save Changes</div>
          <div class="hidden content">
            <i class="right arrow icon"></i>
          </div>
        </button>
        <button class="ui negative animated button" data-action="delete">
          <div class="visible content">Delete</div>
          <div class="hidden content">
            <i class="trash icon"></i>
          </div>
        </button>
      </form>
    </div>
  </template>

  <template id="plex-connection-template">
    <div class="title">
      <i class="dropdown icon"></i>
      New Connection
    </div>
    <div class="content">
      <form class="ui fluid form" form-type="plex">
        <div data-value="enabled" class="ui left aligned checkbox field">
          <input name="enabled" type="checkbox">
          <label>Enabled</label>
        </div>

        <div class="ui required eight wide field">
          <label>Connection Name</label>
          <input name="name" type="text" placeholder="Plex Server">
        </div>

        <div class="ui required eight wide field" data-tooltip="Host URL">
          <label>URL</label>
          <input name="url" type="text" placeholder="http://192.168.0.1:32400/">
        </div>

        <div class="ui required eight wide field" data-tooltip="API key to authenticate communication with">
          <label>Token <a href="https://support.plex.tv/articles/204059436-finding-an-authentication-token-x-plex-token/" target="_blank"><i class="external alternate small icon"></i></a></label>
          <input name="api_key" type="text" class="private" placeholder="hunter2">
        </div>

        <div data-value="use_ssl" class="ui left aligned checkbox field" data-tooltip="Connect with HTTPS instead of HTTP">
          <input name="use_ssl" type="checkbox">
          <label>Use SSL</label>
        </div>

        <div data-value="integrate_with_pmm" class="ui left aligned checkbox field" data-tooltip="Whether to reset PMM overlays when applying title cards">
          <input name="integrate_with_pmm" type="checkbox">
          <label>Integrate with Plex Meta Manager</label>
        </div>

        <div class="ui eight wide field">
          <label>Filesize Limit</label>
          <input name="filesize_limit" type="text" placeholder="5 Megabytes">
        </div>

        <div class="ui error message"></div>
        <button class="ui primary animated button" type="submit" data-action="save">
          <div class="visible content">Save Changes</div>
          <div class="hidden content">
            <i class="right arrow icon"></i>
          </div>
        </button>
        <button class="ui negative animated button" data-action="delete">
          <div class="visible content">Delete</div>
          <div class="hidden content">
            <i class="trash icon"></i>
          </div>
        </button>
      </form>
    </div>
  </template>

  <template id="sonarr-connection-template">
    <div class="title">
      <i class="dropdown icon"></i>
      New Connection
    </div>
    <div class="content">
      <form class="ui fluid form" form-type="sonarr">
        <div data-value="enabled" class="ui left aligned checkbox field">
          <input name="enabled" type="checkbox">
          <label>Enabled</label>
        </div>

        <div class="ui required eight wide field">
          <label>Connection Name</label>
          <input name="name" type="text" placeholder="Sonarr Server">
        </div>

        <div class="ui required eight wide field" data-tooltip="Host URL">
          <label>URL</label>
          <input name="url" type="text" placeholder="http://192.168.0.1:8989/">
        </div>

        <div class="ui required eight wide field" data-tooltip="API key to authenticate communication with">
          <label>API Key</label>
          <input name="api_key" type="text" class="private" placeholder="abcdef">
        </div>

        <div data-value="use_ssl" class="ui left aligned checkbox field" data-tooltip="Connect with HTTPS instead of HTTP">
          <input name="use_ssl" type="checkbox">
          <label>Use SSL</label>
        </div>
        <br>

        <div data-value="downloaded_only" class="ui left aligned checkbox field" data-tooltip="Whether to ignore Episodes that are not downloaded">
          <input name="downloaded_only" type="checkbox">
          <label>Query Downloaded Episodes Only</label>
        </div>

        <div class="ui eight wide field" data-value="libraries">
          <label>Library Paths</label>
          <div class="ui compact floating visible info message">
            <i class="exclamation icon"></i>
            Only required if Syncing from Sonarr - auto-filled libraries are <b>best-guesses</b>, and must be verified.
          </div>
          <div class="ui compact floating visible warning message">
            <i class="exclamation icon"></i>
            Libraries can be added <i>after</i> the Connection is created
          </div>
          <div class="three equal width fields">
            <div class="ui required library field" data-value="media_server">
              <label>Media Server</label>
              <!-- Added asychronously -->
            </div>

            <div class="library field" data-value="library_name">
              <label>Library Name</label> 
              <!-- Added asynchronously -->
            </div>
            
            <div class="library field" data-value="library_path">
              <label>Path</label>
              <!-- Added asynchronously -->
            </div>
          </div>
          <div class="circular ui icon mini button" data-action="add-library">
            <i class="plus square outline icon"></i>
            Add Library
          </div>
          <div class="circular ui icon mini button" data-action="query-libraries" data-tooltip="Attempt to auto-detect Sonarr libraries">
            <i class="search icon"></i>
            Auto-fill Libraries
          </div>
        </div>

        <div class="ui error message"></div>
        <button class="ui primary animated button" type="submit" data-action="save">
          <div class="visible content">Save Changes</div>
          <div class="hidden content">
            <i class="right arrow icon"></i>
          </div>
        </button>
        <button class="ui negative animated button" data-action="delete">
          <div class="visible content">Delete</div>
          <div class="hidden content">
            <i class="trash icon"></i>
          </div>
        </button>
      </form>
    </div>
  </template>
  
</head>

<body onload="initAll();">
  <div class="pusher">
    <!-- Static header and sidebar loaded by external script -->
    <div id="page-header"></div>
    <div id="nav-menu"></div>

    <!-- Actual page content -->
    <div id="main-content" class="article">
      <!-- Page title -->
      <h1 class="ui header">Connections</h1>

      <!-- Authentication -->
      <h2 id="authentication" class="ui dividing header">Authentication</h2>
      <div class="connection-form">
        <!-- Enable button -->
        <div data-value="require_auth" class="ui left aligned checkbox field" data-tooltip="Whether to require a username and password">
          <input type="checkbox">
          <label>Require Authentication</label>
        </div>

        <form id="auth-settings" class="ui fluid form">
          <div class="ui two fields">
            <div class="ui four wide field">
              <label>Username</label>
              <input name="username" type="text">
            </div>

            <div class="ui four wide field">
              <label>Password</label>
              <input name="password" type="password" placeholder="hunter2">
            </div>
          </div>

          <div class=field>
            <button class="ui primary animated button">
              <div class="visible content">Save Changes</div>
              <div class="hidden content">
                <i class="right arrow icon"></i>
              </div>
            </button>
          </div>
        </form>
      </div>

      <!-- Emby Connections -->
      <h2 class="ui dividing header">Emby</h2>
      <button class="ui primary tertiary button" onclick="addConnection('emby');">
        Add Connection
      </button>
      <div id="emby-connections" class="ui styled fluid accordion">
        <!-- Added later -->
      </div>

      <!-- Jellyfin Connections -->
      <h2 class="ui dividing header">Jellyfin</h2>
      <button class="ui primary tertiary button" onclick="addConnection('jellyfin');">
        Add Connection
      </button>
      <div id="jellyfin-connections" class="ui styled fluid accordion">
        <!-- Added later -->
      </div>

      <!-- Plex Connections -->
      <h2 class="ui dividing header">Plex</h2>
      <button class="ui primary tertiary button" onclick="addConnection('plex');">
        Add Connection
      </button>
      <div id="plex-connections" class="ui styled fluid accordion">
        <!-- Added later -->
      </div>

      <!-- Sonarr Connections -->
      <h2 class="ui dividing header">Sonarr</h2>
      <button class="ui primary tertiary button" onclick="addConnection('sonarr');">
        Add Connection
      </button>
      <div id="sonarr-connections" class="ui styled fluid accordion">
        <!-- Added later -->
      </div>

      <!-- Tautulli Integration -->
      <h2 id="tautulli" class="ui dividing header">Tautulli</h2>
      <button id="tautulli-agent-button" class="ui labeled icon blue button">
        <i class="bell icon"></i>
        Create Notification Agent
      </button>

      <!-- TMDb Connections -->
      <h2 class="ui dividing header">TheMovieDatabase</h2>
      <div id="tmdb-connection" class="connection-form">
        <!-- Enable button -->
        <div id="enable-tmdb" class="ui left aligned checkbox field">
          {% if preferences.use_tmdb %}
          <input type="checkbox" name="enable_tmdb" checked="">
          {% else %}
          <input type="checkbox" name="enable_tmdb">
          {% endif %}
          <label>Enable TMDb</label>
        </div>

        <form id="tmdb-settings" class="ui fluid form">
          <!-- Input fields -->
          <div class="ui disabled required eight wide field" data-tooltip="API Key to authenticate communication with TMDb">
            <label>API Key <a href="https://developers.themoviedb.org/3/getting-started/introduction" target="_blank"><i class="external alternate small icon"></i></a></label>
            <input name="api_key"type="text" class="private" placeholder="{{preferences.tmdb_api_key}}" value="{{preferences.tmdb_api_key}}">
          </div>

          <div class="two fields">
            <div class="two wide field" data-tooltip="Minimum required width of images to gather from TMDb">
              <label>Minimum Width</label>
              <input name="minimum_width" type="number" value="{{preferences.tmdb_minimum_width}}">
            </div>
            <div class="two wide field" data-tooltip="Minimum required height of images to gather from TMDb">
              <label>Minimum Height</label>
              <input name="minimum_height" type="number" value="{{preferences.tmdb_minimum_height}}">
            </div>
          </div>

          <div class="ui left aligned checkbox field" data-tooltip="Whether to ignore images with assigned languages">
            {% if preferences.tmdb_skip_localized %}
            <input name="skip_localized" type="checkbox" checked="">
            {% else %}
            <input name="skip_localized" type="checkbox" >
            {% endif %}
            <label>Ignore Localized Images</label>
          </div>

          <br>
          <div class="ui left aligned checkbox field" data-tooltip="Whether to download logos automatically">
            {% if preferences.tmdb_download_logos %}
            <input name="download_logos" type="checkbox" checked="">
            {% else %}
            <input name="download_logos" type="checkbox">
            {% endif %}
            <label>Download Logos</label>
          </div>

          <div class="field">
            <label>Logo Language Priority</label>
            <div data-value="tmdb_logo_language_priority" class="ui compact multiple selection dropdown">
              <input name="logo_language_priority" type="hidden">
              <i class="dropdown icon"></i>
              <div class="default text"></div>
              <div class="menu"><!-- Added asynchronousely --></div>
            </div>
          </div>

          <div class="ui error message"></div>
          <button id="submit-tmdb" class="ui primary animated button" type="submit">
            <div class="visible content">Save Changes</div>
            <div class="hidden content">
              <i class="right arrow icon"></i>
            </div>
          </button>
        </form>
      </div>
    </div>

    <div id="tautulli-agent-modal" class="ui small modal">
      <i class="close icon"></i>
      <div class="header">Tautulli Notification Agent</div>
      <div class="content">
        <div class="ui compact floating visible info message">
          <!-- <i class="info circle icon"></i>
          <b>Info</b> -->
          <ul class="list">
            <li>A Tautulli Notification Agent can be used to immediately update Title Cards for newly added or recently watched Episodes.</li>
            <li>This bypasses the Scheduler, and is <i>highly</i> recommended for Plex users.</li>
          </ul>
        </div>
        <form id="tautulli-agent-form" class="ui form">
          <div class="ui field">
            <label>Tautulli URL</label>
            <input name="tautulli_url">
          </div>
          
          <div class="ui field">
            <label>Tautulli API Key</label>
            <input name="tautulli_api_key" type="password">
          </div>

          <div class="ui left aligned checkbox field">
            <input name="tautulli_use_ssl" type="checkbox" checked="">
            <label>Use SSL</label>
          </div>

          <div class="ui field">
            <label>Notification Agent Name</label>
            <input name="tautulli_agent_name" value="Update TitleCardMaker" placeholder="Update TitleCardMaker">
          </div>
          <div class="ui info message"></div>
        </form>
      </div>
      <div class="actions">
        <button form="tautulli-agent-form" class="ui right labeled icon blue button">
          Create Agent
          <i class="checkmark icon"></i>
        </button>
      </div>
    </div>
  </div>
</body>

</html>